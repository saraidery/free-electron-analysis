import numpy as np
import pytest
import os

from obara_saika import ERIGTO

class TestERIGTO:
    def __eri__(self, l_a, l_b, l_c, l_d, eri_ref):

        A = np.array([0.00,  1.200,  0.700])
        B = np.array([0.10,  0.300,  0.25])
        C = np.array([0.30,  0.000,  -0.25])
        D = np.array([0.40,  0.200,  -0.700])
        alpha = 0.8
        beta = 1.2
        gamma = 1.1
        delta = 0.5

        eri = ERIGTO(A, alpha, l_a, B, beta, l_b, C, gamma, l_c, D, delta, l_d)

        assert np.allclose(eri.integral().flatten(), eri_ref.flatten())

    def test_eri_ssss(self):
        eri_ref = np.array([2.4268106])
        self.__eri__(0, 0, 0, 0, eri_ref)

    def test_eri_psss(self):
        eri_ref = np.array([ 0.22021627, -1.47482081, -0.88095275])
        self.__eri__(1, 0, 0, 0, eri_ref)

    def test_eri_spss(self):
        eri_ref = np.array([-0.02246479, 0.70930872, 0.21111202])
        self.__eri__(0, 1, 0, 0, eri_ref)

    def test_eri_ssps(self):
        eri_ref = np.array([-0.01742172, 0.35710453, -0.05912788])
        self.__eri__(0, 0, 1, 0, eri_ref)

    def test_eri_sssp(self):
        eri_ref = np.array([-0.26010278, -0.12825759,  1.03293689])
        self.__eri__(0, 0, 0, 1, eri_ref)

    def test_eri_spps(self):
        eri_ref = np.array([ 0.08301695, 0.00351809, 0.00991933,
                            0.00173175, 0.17529691,-0.03792619,
                            0.00785644, 0.0104208 , 0.05245638])
        self.__eri__(0, 1, 1, 0, eri_ref)

    def test_eri_pssp(self):
        eri_ref = np.array([0.05925315, -0.00481471, 0.10310386,
                            0.16489338,  0.148867, -0.64838046,
                            0.10379149,  0.02591431, -0.31736481])
        self.__eri__(1, 0, 0, 1, eri_ref)

    def test_eri_dsss(self):
        eri_ref = np.array([ 0.56040121,-0.24125529,-0.15144698, 1.44624257, 0.95589778, 0.88041593])
        self.__eri__(2, 0, 0, 0, eri_ref)

    def test_eri_sdss(self):
        eri_ref = np.array([ 0.54062606, -0.02082797, -0.01637106,  0.75728169,  0.13547978,  0.5789876 ])
        self.__eri__(0, 2, 0, 0, eri_ref)

    def test_eri_ssds(self):
        eri_ref = np.array([ 0.65493378,-0.01921419,-0.01955574, 0.72227324, 0.0296262 , 0.68781892])
        self.__eri__(0, 0, 2, 0, eri_ref)

    def test_eri_sssd(self):
        eri_ref = np.array([ 0.68268623,  0.00903573, -0.21204454,  0.67650385, -0.0498582, 1.12603297])
        self.__eri__(0, 0, 0, 2, eri_ref)

    def test_eri_pppp(self):
        eri_ref = np.array([ 1.57877250e-01, -5.67653422e-04,  4.87350045e-03,
                            -5.67047932e-03,  1.46250440e-01,  3.53086828e-02,
                             1.83476495e-03,  6.26849526e-03,  1.45594942e-01,
                             1.26559461e-02,  5.71331392e-03,  9.16095147e-03,
                             7.44043391e-03,  1.91680043e-02,  1.05646994e-02,
                             1.02773590e-03,  2.07030825e-03,  1.59979919e-02,
                             4.94972896e-03, -7.55880027e-04,  4.49242780e-03,
                            -7.98079873e-04,  3.73576095e-03,  2.06927994e-03,
                             3.88255606e-03,  6.59637147e-04,  1.03001716e-02,
                             1.62995795e-02,  3.42330623e-03, -3.18701743e-02,
                            -7.75766249e-03,  4.73827554e-03, -1.39757991e-03,
                            -5.79011949e-03,  4.48170504e-04,  1.23053249e-03,
                             3.23828761e-02,  2.02697929e-03, -8.82508884e-04,
                             4.15605171e-03,  3.15965629e-02, -1.48663342e-02,
                            -2.36866859e-04, -3.99422433e-03,  3.24776620e-02,
                            -3.59986325e-02,  3.63513405e-04,  5.59776384e-04,
                            -1.54586529e-04, -3.59635005e-02, -8.19889253e-03,
                             6.63477028e-03,  1.61964555e-03, -6.72958867e-02,
                             1.00625561e-02, -2.18896640e-03, -1.60610281e-02,
                            -9.59729850e-03,  1.12219761e-03, -1.54892878e-03,
                             1.46450554e-03,  1.64644121e-04,  1.48787484e-03,
                            -6.56177260e-02,  2.95625614e-03,  9.00813746e-04,
                             1.06469473e-02, -7.73752099e-02, -2.94652710e-02,
                            -2.28312437e-03, -1.22503706e-03, -5.44387828e-02,
                             1.30304305e-01, -1.63288418e-03, -1.64256931e-03,
                            -9.74243094e-03,  1.29454855e-01,  2.55657765e-02,
                             5.30290214e-03,  2.96375896e-03,  1.14288362e-01])
        self.__eri__(1, 1, 1, 1, eri_ref)

    def test_eri_dssp(self): # (ds|sp) = [dp|ss]
        eri_ref = np.array([-0.03656602, -0.03443589,  0.23190876,
                            -0.070775  ,  0.02077385, -0.11701344,
                            -0.04879911, -0.00074807, -0.05802691,
                            -0.16095694, -0.18037683,  0.63357404,
                            -0.11782438, -0.08566202,  0.35200278,
                            -0.09927603, -0.0357057 ,  0.30992383])
        self.__eri__(2, 0, 0, 1, eri_ref)
